SELECT
	day
	, day_of_the_week
	, total_prefered_day
	, cum_pref_total
	, cum_total
	, CONCAT(ROUND(percentage_weekend * 100, 2), '%') as weekend
	, CONCAT(ROUND(percentage_weekday * 100, 2), '%') as weekday
	FROM (
	SELECT 
		*
		, CASE 
			WHEN day_of_the_week = 'Weekend'
				THEN cum_pref_total / cum_total
			ELSE 1 - (cum_pref_total / cum_total)
		  END AS Percentage_weekend
		, CASE 
			WHEN day_of_the_week = 'Weekday'
				THEN cum_pref_total / cum_total
			ELSE 1 - (cum_pref_total / cum_total)
		  END AS Percentage_weekday
		FROM (
		SELECT 
			*
			, SUM(total_prefered_day) OVER (PARTITION BY day_of_the_week ORDER BY day) AS cum_pref_total
			, SUM(total_prefered_day) OVER (ORDER BY day) as cum_total
			FROM (
			SELECT 
				day
				, day_of_the_week
				, SUM(day_total) as total_prefered_day
				FROM b_total_rides_info b
					GROUP BY
						day			
						, day_of_the_week
			) a
			WHERE day > day-7
			ORDER BY 
				day
		) b
	)d
